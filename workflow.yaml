# Yandex Cloud Workflow –¥–ª—è Telegram –±–æ—Ç–∞
# –≠—Ç–æ—Ç workflow –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

yawl: "0.1"
start: receive_message

steps:
  receive_message:
    title: "–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è"
    input: ${input}
    output:
      chat_id: ${input.body.message.chat.id}
      message_text: ${input.body.message.text}
      user_id: ${input.body.message.from.id}
    next: check_command

  check_command:
    title: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã"
    switch:
      - condition: ${message_text == "/start"}
        next: send_welcome
      - condition: ${message_text == "/help"}
        next: send_help
      - default:
          next: process_with_ai

  send_welcome:
    title: "–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è"
    httpCall:
      url: https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage
      method: POST
      body:
        chat_id: ${chat_id}
        text: |
          üëã –ü—Ä–∏–≤–µ—Ç! –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ –±–∞–∑–µ Yandex Cloud.
          
          –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
          /start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
          /help - –ü–æ–º–æ—â—å
          
          –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!
        parse_mode: Markdown
    next: end

  send_help:
    title: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ø—Ä–∞–≤–∫–∏"
    httpCall:
      url: https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage
      method: POST
      body:
        chat_id: ${chat_id}
        text: |
          üìö *–°–ø—Ä–∞–≤–∫–∞*
          
          –Ø —É–º–µ—é –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã —Å –ø–æ–º–æ—â—å—é AI.
          –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!
        parse_mode: Markdown
    next: end

  process_with_ai:
    title: "–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ AI"
    # –í—ã–∑—ã–≤–∞–µ–º Cloud Function –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ AI
    functionCall:
      functionId: ${AI_FUNCTION_ID}
      input:
        chat_id: ${chat_id}
        message: ${message_text}
    output:
      ai_response: ${output.response}
    next: send_ai_response

  send_ai_response:
    title: "–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ AI"
    httpCall:
      url: https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage
      method: POST
      body:
        chat_id: ${chat_id}
        text: ${ai_response}
        parse_mode: Markdown
    next: end

  end:
    title: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ"
    return:
      status: "ok"

